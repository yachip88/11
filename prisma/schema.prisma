generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlserver"
  url      = env("DATABASE_URL")
}

model RTS {
  id        String   @id @default(uuid()) @db.VarChar(255)
  name      String   @db.NVarChar(Max)
  code      String   @unique @db.VarChar(255)
  location  String   @db.NVarChar(Max)
  createdAt DateTime @default(now()) @map("created_at")

  districts Districts[]
  ctps      CTP[]

  @@map("rts")
}

model Districts {
  id        String   @id @default(uuid()) @db.VarChar(255)
  name      String   @db.NVarChar(Max)
  rtsId     String?  @map("rts_id") @db.VarChar(255)
  createdAt DateTime @default(now()) @map("created_at")

  rts  RTS?  @relation(fields: [rtsId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  ctps CTP[]

  @@map("districts")
}

model CTP {
  id           String   @id @default(uuid()) @db.VarChar(255)
  name         String   @db.NVarChar(Max)
  code         String   @unique @db.VarChar(255)
  rtsId        String?  @map("rts_id") @db.VarChar(255)
  districtId   String?  @map("district_id") @db.VarChar(255)
  ucl          Float?   @db.Real
  cl           Float?   @db.Real
  lcl          Float?   @db.Real
  hasMeter     Boolean  @default(true) @map("has_meter")
  meterStatus  String   @default("working") @map("meter_status") @db.NVarChar(100)
  createdAt    DateTime @default(now()) @map("created_at")

  rts                 RTS?                  @relation(fields: [rtsId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  district            Districts?            @relation(fields: [districtId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  measurements        Measurements[]
  statisticalParams   StatisticalParams[]
  recommendations     Recommendations[]

  @@map("ctp")
}

model Measurements {
  id          String   @id @default(uuid()) @db.VarChar(255)
  ctpId       String   @map("ctp_id") @db.VarChar(255)
  date        DateTime
  makeupWater Float    @map("makeup_water") @db.Real
  undermix    Float    @default(0) @db.Real
  flowG1      Float?   @map("flow_g1") @db.Real
  temperature Float?   @db.Real
  pressure    Float?   @db.Real
  createdAt   DateTime @default(now()) @map("created_at")

  ctp CTP @relation(fields: [ctpId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@map("measurements")
}

model StatisticalParams {
  id           String   @id @default(uuid()) @db.VarChar(255)
  ctpId        String   @map("ctp_id") @db.VarChar(255)
  mean         Float    @db.Real
  stdDev       Float    @map("std_dev") @db.Real
  ucl          Float    @db.Real
  cl           Float    @db.Real
  lcl          Float    @db.Real
  sampleSize   Int      @map("sample_size")
  calculatedAt DateTime @default(now()) @map("calculated_at")

  ctp CTP @relation(fields: [ctpId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@map("statistical_params")
}

model Recommendations {
  id          String   @id @default(uuid()) @db.VarChar(255)
  ctpId       String   @map("ctp_id") @db.VarChar(255)
  type        String   @db.NVarChar(100)
  priority    String   @db.NVarChar(50)
  title       String   @db.NVarChar(Max)
  description String   @db.NVarChar(Max)
  actions     String?  @db.NVarChar(Max)
  status      String   @default("open") @db.NVarChar(50)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @default(now()) @updatedAt @map("updated_at")

  ctp CTP @relation(fields: [ctpId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@map("recommendations")
}

model UploadedFiles {
  id               String   @id @default(uuid()) @db.VarChar(255)
  filename         String   @db.NVarChar(Max)
  originalName     String   @map("original_name") @db.NVarChar(Max)
  fileType         String   @map("file_type") @db.NVarChar(50)
  size             Int
  status           String   @default("processing") @db.NVarChar(50)
  recordsProcessed Int      @default(0) @map("records_processed")
  errors           String?  @db.NVarChar(Max)
  uploadedAt       DateTime @default(now()) @map("uploaded_at")

  @@map("uploaded_files")
}
